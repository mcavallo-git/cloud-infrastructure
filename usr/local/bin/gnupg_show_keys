#!/bin/bash
#
# Check GPG Key(s) saved locally
#

GnuPG_PrimaryKeyID=$(gpg --list-secret-keys --keyid-format 'LONG' | sed --regexp-extended --quiet --expression='s/^sec\ +([A-Za-z0-9]+)\/([A-F0-9]{16})\ +([0-9\-]{1,10})\ +(.+)$/\2/p');
GnuPG_SecondaryKeyID=$(gpg --list-secret-keys --keyid-format 'LONG' | sed --regexp-extended --quiet --expression='s/^ssb\ +([A-Za-z0-9]+)\/([A-F0-9]{16})\ +([0-9\-]{1,10})\ +(.+)$/\2/p');
GnuPG_PrimaryPrivateKey=$(gpg --armor --export-secret-keys "${GnuPG_PrimaryKeyID}");
GnuPG_PrimaryPublicKey=$(gpg --armor --export "${GnuPG_PrimaryKeyID}");
GnuPG_SecondaryPrivateKey=$(gpg --armor --export-secret-keys "${GnuPG_SecondaryKeyID}");
GnuPG_SecondaryPublicKey=$(gpg --armor --export "${GnuPG_SecondaryKeyID}");

OutputDirname="${HOME}/Desktop/GnuPG_Keys_$(date +'%Y%m%d%H%M%S')";

mkdir -p "${OutputDirname}";
chmod -R 0400 "${OutputDirname}";

echo "${GnuPG_PrimaryKeyID}" > "${OutputDirname}/GnuPG_PrimaryKeyID.txt";
echo "${GnuPG_PrimaryPrivateKey}" > "${OutputDirname}/GnuPG_PrimaryKey.pem";
echo "${GnuPG_PrimaryPublicKey}" > "${OutputDirname}/GnuPG_PrimaryKey.pub";
echo "${GnuPG_SecondaryKeyID}" > "${OutputDirname}/GnuPG_SecondaryKeyID.txt";
echo "${GnuPG_SecondaryPrivateKey}" > "${OutputDirname}/GnuPG_SecondaryKey.pem";
echo "${GnuPG_SecondaryPublicKey}" > "${OutputDirname}/GnuPG_SecondaryKey.pub";

chmod -R 0400 "${OutputDirname}";


# ------------------------------------------------------------
#
# Citation(s)
#
#   help.github.com  |  "Generating a new GPG key - GitHub Docs"  |  https://help.github.com/en/articles/generating-a-new-gpg-key
#
#   git.gnupg.org  |  "GnuPG Details"  |  https://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob_plain;f=doc/DETAILS
#
#   www.gnupg.org  |  "gnupg.pdf"  |  https://www.gnupg.org/documentation/manuals/gnupg.pdf
#
#   www.gnupg.org  |  "Making and verifying signatures"  |  https://www.gnupg.org/gph/en/manual/x135.html
#
#   wiki.archlinux.org  |  "GnuPG - ArchWiki"  |  https://wiki.archlinux.org/title/GnuPG
#
#   wiki.debian.org  |  "Subkeys - Debian Wiki"  |  https://wiki.debian.org/Subkeys
#
# ------------------------------------------------------------
