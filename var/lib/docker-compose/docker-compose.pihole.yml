# ------------------------------------------------------------
#
### Deploy this docker remotely
#
# WEBPASSWORD="PASTE_PASSWORD_HERE"; CONFIG_DIR="/root/docker-configs/pihole"; DOMAIN=".localdomain"; mkdir -p "${CONFIG_DIR}/etc/dnsmasq.d"; mkdir -p "${CONFIG_DIR}/etc/pihole"; curl -sL "https://raw.githubusercontent.com/mcavallo-git/cloud-infrastructure/master/var/lib/docker-compose/docker-compose.pihole.yml" -o "${CONFIG_DIR}/docker-compose.pihole.yml"; env CONFIG_DIR="${CONFIG_DIR}" DOMAIN="${DOMAIN}" WEBPASSWORD="${WEBPASSWORD}" docker-compose -f "${CONFIG_DIR}/docker-compose.pihole.yml" up -d; watch docker logs pihole;
# 
# ------------------------------------------------------------

version: "3"

services:
  pihole:
    hostname: '${HOSTNAME_PIHOLE:-pihole}${DOMAIN_PIHOLE}'
    container_name: '${HOSTNAME_PIHOLE:-pihole}'
    image: pihole/pihole:latest
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "67:67/udp"
      - "80:80/tcp"
      - "443:443/tcp"
    environment:
      ServerIP: '${SERVER_IP}'
      TZ: '${TZ:-America/New_York}'
      VIRTUAL_HOST: '${VIRTUAL_HOST:-${HOSTNAME_PIHOLE:-${SERVER_IP:-pihole}}}'
      WEBPASSWORD: '${WEBPASSWORD}'
      WEBUIBOXEDLAYOUT: 'boxed'
    volumes:  # Volumes store your data between container upgrades
      - /etc/hosts:/etc/hosts:ro
      - '${CONFIG_DIR:-.}/etc/pihole/:/etc/pihole/'
      - '${CONFIG_DIR:-.}/etc/dnsmasq.d/:/etc/dnsmasq.d/'
      - '${CONFIG_DIR:-.}/etc/resolv.conf:/etc/resolv.conf:ro'
      # - '${CONFIG_DIR:-.}/etc/lighttpd/external.conf:/etc/lighttpd/external.conf:ro'
      # - '${CONFIG_DIR:-.}/etc/letsencrypt/live/pihole/privkey.pem:/etc/letsencrypt/live/pihole/privkey.pem:ro'
      # - '${CONFIG_DIR:-.}/etc/letsencrypt/live/pihole/fullchain.pem:/etc/letsencrypt/live/pihole/fullchain.pem:ro'
    # Recommended but not required (DHCP needs NET_ADMIN)
    #   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
    cap_add:
      - NET_ADMIN
    restart: always


# ------------------------------------------------------------
#
# Citation(s)
#
#   docs.pi-hole.net  |  "Overview of Pi-hole - Pi-hole documentation"  |  https://docs.pi-hole.net/
#
#   github.com  |  "GitHub - pi-hole/docker-pi-hole: Pi-hole in a docker container"  |  https://github.com/pi-hole/docker-pi-hole/
#
#   hub.docker.com  |  "pihole/pihole - Docker Hub"  |  https://hub.docker.com/r/pihole/pihole
#
# ------------------------------------------------------------