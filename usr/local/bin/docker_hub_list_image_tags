#!/bin/bash
# ------------------------------------------------------------
if [ 0 -eq 1 ]; then # RUN THIS SCRIPT REMOTELY:

# Option 1:  Sync basic + utility methods (only)
curl -H "Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" -ssL "https://raw.githubusercontent.com/mcavallo-git/cloud-infrastructure/master/usr/local/sbin/sync_cloud_infrastructure?t=$(date +'%s.%N')" | bash;

# Option 2:  Sync basic + utility + optional methods using opt-In methodology (will ask user per-module before installing them)
curl -H "Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" -ssL "https://raw.githubusercontent.com/mcavallo-git/cloud-infrastructure/master/usr/local/sbin/sync_cloud_infrastructure?t=$(date +'%s.%N')" | bash -s -- --all;

fi;
# ------------------------------------------------------------

function listAllTags() {
  local repo=${1};
  local page_size=${2:-100};
  [ -z "${repo}" ] && echo "Usage: listTags <repoName> [page_size]" 1>&2 && return 1;
  local base_url="https://registry.hub.docker.com/api/content/v1/repositories/public/library/${repo}/tags";
  local page=1;
  local res=$(curl "${base_url}?page_size=${page_size}&page=${page}" 2>/dev/null);
  local tags=$(echo ${res} | jq --raw-output '.results[].name');
  local all_tags="${tags}";
  local tag_count=$(echo ${res} | jq '.count');
  ((page_count=(${tag_count}+${page_size}-1)/${page_size}))  # ceil(tag_count / page_size);
  for page in $(seq 2 $page_count); do
    tags=$(curl "${base_url}?page_size=${page_size}&page=${page}" 2>/dev/null | jq --raw-output '.results[].name');
    all_tags="${all_tags}${tags}";
  done;
  echo "${all_tags}" | sort;
}

# Example call
listAllTags nginx;


# ------------------------------------------------------------
#
# Citation(s)
#
#   forums.docker.com  |  "How can I list tags for a repository? - Docker Hub - Docker Community Forums"  |  https://forums.docker.com/t/how-can-i-list-tags-for-a-repository/32577/9
#
# ------------------------------------------------------------