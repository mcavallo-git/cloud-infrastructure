#!/bin/bash

EXIT_CODE=1;

HOST_NAME="";
if [ -n "${1}" ]; then
  HOST_NAME="${1}";
else
  echo "";
  read -p "Enter HTTP Host (or call script with host as first argument, e.g. \${1}}):  " -t 60 -r;
  HOST_NAME="${REPLY}";
fi;

if [ -z "${HOST_NAME}" ]; then

  echo "Error: Blank hostname given";
  EXIT_CODE=1;

else

  if [ -z "$(which nmap 2>'/dev/null')" ]; then

    # Install the "nmap" package
    echo "";
    echo "Error: command \"nmap\" not found";
    read -p " |-->  Install package \"nmap\", now? (y/n)   " -n 1 -t 60 -r; # Await single keypress
    if [ -n "${REPLY}" ] && [ "$(echo ${REPLY} | tr '[:lower:]' '[:upper:]';)" == "Y" ]; then
      if [ -n "$(which apt-get 2>'/dev/null';)" ]; then
        sudo apt-get install -y "nmap";
      elif [ -n "$(which yum 2>'/dev/null';)" ]; then
        sudo yum install -y "nmap";
      elif [ -n "$(which apk 2>'/dev/null';)" ]; then
        sudo apk install -y "nmap";
      fi;
    fi;
  fi;
  # 
  if [ -n "$(which nmap 2>'/dev/null';)" ]; then
    nmap -T Aggressive -A -v "${HOST_NAME}" -p 1-65535;
    EXIT_CODE=0;
  fi;

fi;

exit ${EXIT_CODE};
