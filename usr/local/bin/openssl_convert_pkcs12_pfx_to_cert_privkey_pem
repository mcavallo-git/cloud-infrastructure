#!/bin/bash
# ------------------------------------------------------------
if [ 0 -eq 1 ]; then # RUN THIS SCRIPT REMOTELY:

# Decrypt pkcs12/pfx certificate
CERT_FULLPATH=""; CERT_PASSWORD=""; curl -H "Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" -ssL "https://raw.githubusercontent.com/mcavallo-git/cloud-infrastructure/master/usr/local/bin/openssl_convert_pkcs12_pfx_to_cert_privkey_pem?t=$(date +'%s.%N')" | bash -s -- "${CERT_FULLPATH}" "${CERT_PASSWORD}";

fi;
# ------------------------------------------------------------
#
# DONT USE GIT BASH  - USE WSL INSTEAD
#

if [ -n "${1}" ] && [ -f "${1}" ]; then


  if [ -n "${2}" ]; then

    # Decrypt password-encrypted pkcs12/pfx certificate

    openssl pkcs12 -in "${1}" -pass "pass:${2}" -clcerts -nokeys -out "${1}.cert.pem";

    openssl pkcs12 -in "${1}" -pass "pass:${2}" -nodes -out "${1}.key.pem";

    openssl pkcs12 -in "${1}" -pass "pass:${2}" -nokeys -out "${1}.chain.pem";

  else

    # Decrypt NON-password-encrypted pkcs12/pfx certificate

    openssl pkcs12 -in "${1}" -clcerts -nokeys -out "${1}.cert.pem";

    openssl pkcs12 -in "${1}" -nocerts -nodes -out "${1}.key.pem";

    openssl pkcs12 -in "${1}" -cacerts -nokeys -out "${1}.chain.pem";

  fi;

fi;


# ------------------------------------------------------------
#
# Citation(s)
#
#   superuser.com  |  "linux - How to use password argument in via command line to openssl for decryption - Super User"  |  https://superuser.com/a/724987
#
# ------------------------------------------------------------